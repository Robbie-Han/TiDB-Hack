{"version":3,"file":"fruchterman.js","sources":["webpack://[name]/webpack/universalModuleDefinition","webpack://[name]/webpack/bootstrap","webpack://[name]/./node_modules/_@antv_util@1.3.1@@antv/util/lib/deep-mix.js","webpack://[name]/./node_modules/_@antv_util@1.3.1@@antv/util/lib/each.js","webpack://[name]/./node_modules/_@antv_util@1.3.1@@antv/util/lib/event/wrap-behavior.js","webpack://[name]/./node_modules/_@antv_util@1.3.1@@antv/util/lib/type/is-array.js","webpack://[name]/./node_modules/_@antv_util@1.3.1@@antv/util/lib/type/is-object-like.js","webpack://[name]/./node_modules/_@antv_util@1.3.1@@antv/util/lib/type/is-object.js","webpack://[name]/./node_modules/_@antv_util@1.3.1@@antv/util/lib/type/is-plain-object.js","webpack://[name]/./node_modules/_@antv_util@1.3.1@@antv/util/lib/type/is-type.js","webpack://[name]/./plugins/base.js","webpack://[name]/./plugins/fruchterman/index.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"@antv/g6\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"@antv/g6\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Fruchterman\"] = factory(require(\"@antv/g6\"));\n\telse\n\t\troot[\"Fruchterman\"] = factory(root[\"G6\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE__antv_g6__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./plugins/fruchterman/index.js\");\n","var isPlainObject = require('./type/is-plain-object');\nvar isArray = require('./type/is-array');\n\nvar MAX_MIX_LEVEL = 5;\n\nfunction _deepMix(dist, src, level, maxLevel) {\n  level = level || 0;\n  maxLevel = maxLevel || MAX_MIX_LEVEL;\n  for (var key in src) {\n    if (src.hasOwnProperty(key)) {\n      var value = src[key];\n      if (value !== null && isPlainObject(value)) {\n        if (!isPlainObject(dist[key])) {\n          dist[key] = {};\n        }\n        if (level < maxLevel) {\n          _deepMix(dist[key], value, level + 1, maxLevel);\n        } else {\n          dist[key] = src[key];\n        }\n      } else if (isArray(value)) {\n        dist[key] = [];\n        dist[key] = dist[key].concat(value);\n      } else if (value !== undefined) {\n        dist[key] = value;\n      }\n    }\n  }\n}\n\nvar deepMix = function deepMix() {\n  var args = new Array(arguments.length);\n  var length = args.length;\n  for (var i = 0; i < length; i++) {\n    args[i] = arguments[i];\n  }\n  var rst = args[0];\n  for (var _i = 1; _i < length; _i++) {\n    _deepMix(rst, args[_i]);\n  }\n  return rst;\n};\n\nmodule.exports = deepMix;","var isObject = require('./type/is-object');\nvar isArray = require('./type/is-array');\n\nvar each = function each(elements, func) {\n  if (!elements) {\n    return;\n  }\n  var rst = void 0;\n  if (isArray(elements)) {\n    for (var i = 0, len = elements.length; i < len; i++) {\n      rst = func(elements[i], i);\n      if (rst === false) {\n        break;\n      }\n    }\n  } else if (isObject(elements)) {\n    for (var k in elements) {\n      if (elements.hasOwnProperty(k)) {\n        rst = func(elements[k], k);\n        if (rst === false) {\n          break;\n        }\n      }\n    }\n  }\n};\n\nmodule.exports = each;","/**\n * 封装事件，便于使用上下文this,和便于解除事件时使用\n * @protected\n * @param  {Object} obj   对象\n * @param  {String} action 事件名称\n * @return {Function}        返回事件处理函数\n */\nfunction wrapBehavior(obj, action) {\n  if (obj['_wrap_' + action]) {\n    return obj['_wrap_' + action];\n  }\n  var method = function method(e) {\n    obj[action](e);\n  };\n  obj['_wrap_' + action] = method;\n  return method;\n}\n\nmodule.exports = wrapBehavior;","var isType = require('./is-type');\n\nvar isArray = Array.isArray ? Array.isArray : function (value) {\n  return isType(value, 'Array');\n};\n\nmodule.exports = isArray;","var _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar isObjectLike = function isObjectLike(value) {\n  /**\n   * isObjectLike({}) => true\n   * isObjectLike([1, 2, 3]) => true\n   * isObjectLike(Function) => false\n   * isObjectLike(null) => false\n   */\n  return (typeof value === 'undefined' ? 'undefined' : _typeof(value)) === 'object' && value !== null;\n};\n\nmodule.exports = isObjectLike;","var _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar isObject = function isObject(value) {\n  /**\n   * isObject({}) => true\n   * isObject([1, 2, 3]) => true\n   * isObject(Function) => true\n   * isObject(null) => false\n   */\n  var type = typeof value === 'undefined' ? 'undefined' : _typeof(value);\n  return value !== null && type === 'object' || type === 'function';\n};\n\nmodule.exports = isObject;","var isObjectLike = require('./is-object-like');\nvar isType = require('./is-type');\n\nvar isPlainObject = function isPlainObject(value) {\n  /**\n   * isObjectLike(new Foo) => false\n   * isObjectLike([1, 2, 3]) => false\n   * isObjectLike({ x: 0, y: 0 }) => true\n   * isObjectLike(Object.create(null)) => true\n   */\n  if (!isObjectLike(value) || !isType(value, 'Object')) {\n    return false;\n  }\n  if (Object.getPrototypeOf(value) === null) {\n    return true;\n  }\n  var proto = value;\n  while (Object.getPrototypeOf(proto) !== null) {\n    proto = Object.getPrototypeOf(proto);\n  }\n  return Object.getPrototypeOf(value) === proto;\n};\n\nmodule.exports = isPlainObject;","var toString = {}.toString;\nvar isType = function isType(value, type) {\n  return toString.call(value) === '[object ' + type + ']';\n};\n\nmodule.exports = isType;","var deepMix = require('@antv/util/lib/deep-mix');\n\nvar each = require('@antv/util/lib/each');\n\nvar wrapBehavior = require('@antv/util/lib/event/wrap-behavior');\n\nvar PluginBase =\n/*#__PURE__*/\nfunction () {\n  function PluginBase(cfgs) {\n    this._cfgs = deepMix(this.getDefaultCfgs(), cfgs);\n  }\n\n  var _proto = PluginBase.prototype;\n\n  _proto.getDefaultCfgs = function getDefaultCfgs() {\n    return {};\n  };\n\n  _proto.initPlugin = function initPlugin(graph) {\n    var self = this;\n    self.set('graph', graph);\n    var events = self.getEvents();\n    var bindEvents = {};\n    each(events, function (v, k) {\n      var event = wrapBehavior(self, v);\n      bindEvents[k] = event;\n      graph.on(k, event);\n    });\n    this._events = bindEvents;\n    this.init();\n  };\n\n  _proto.init = function init() {};\n\n  _proto.getEvents = function getEvents() {\n    return {};\n  };\n\n  _proto.get = function get(key) {\n    return this._cfgs[key];\n  };\n\n  _proto.set = function set(key, val) {\n    this._cfgs[key] = val;\n  };\n\n  _proto.destroy = function destroy() {};\n\n  _proto.destroyPlugin = function destroyPlugin() {\n    this.destroy();\n    var graph = this.get('graph');\n    var events = this._events;\n    each(events, function (v, k) {\n      graph.off(k, v);\n    });\n    this._events = null;\n    this._cfgs = null;\n    this.destroyed = true;\n  };\n\n  return PluginBase;\n}();\n\nmodule.exports = PluginBase;","function _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; subClass.__proto__ = superClass; }\n\nvar Base = require('../base');\n\nvar Util = require('@antv/g6').Util;\n\nvar SPEED_DIVISOR = 800;\n\nvar Fruchterman =\n/*#__PURE__*/\nfunction (_Base) {\n  _inheritsLoose(Fruchterman, _Base);\n\n  function Fruchterman() {\n    return _Base.apply(this, arguments) || this;\n  }\n\n  var _proto = Fruchterman.prototype;\n\n  _proto.getDefaultCfgs = function getDefaultCfgs() {\n    return {\n      maxIteration: 1000,\n      // 停止迭代的最大迭代数\n      center: [0, 0],\n      // 布局中心\n      gravity: 10,\n      // 重力大小，影响图的紧凑程度\n      speed: 1,\n      // 速度\n      onLayoutEnd: function onLayoutEnd() {},\n      // 布局完成回调\n      onTick: function onTick() {} // 每一迭代布局回调\n\n    };\n  };\n\n  _proto.init = function init() {\n    var graph = this.get('graph');\n    var onTick = this.get('onTick');\n\n    var tick = function tick() {\n      onTick && onTick();\n      graph.refreshPositions();\n    };\n\n    this.set('tick', tick);\n  };\n\n  _proto.layout = function layout(data) {\n    var self = this;\n    self.set('data', data);\n    var graph = self.get('graph');\n    var nodes = data.nodes;\n    var center = self.get('center');\n    var width = graph.get('width');\n    var height = graph.get('height');\n\n    if (nodes.length === 0) {\n      return;\n    } else if (nodes.length === 1) {\n      nodes[0].x = center[0];\n      nodes[0].y = center[1];\n      return;\n    }\n\n    var positions = Util.randomInitPos(nodes.length, [0, width], [0, height]);\n    var nodeMap = new Map();\n    var nodeIndexMap = new Map();\n    nodes.forEach(function (node, i) {\n      node.x = positions[i][0];\n      node.y = positions[i][1];\n      nodeMap.set(node.id, node);\n      nodeIndexMap.set(node.id, i);\n    });\n    self.set('nodeMap', nodeMap);\n    self.set('nodeIndexMap', nodeIndexMap); // 如果正在布局，忽略布局请求\n\n    if (self.isTicking()) {\n      return;\n    } // layout\n\n\n    self.run();\n    nodes.forEach(function (node) {\n      node.x += center[0];\n      node.y += center[1];\n    });\n    graph.refreshPositions();\n    var onLayoutEnd = self.get('onLayoutEnd');\n    onLayoutEnd();\n  };\n\n  _proto.run = function run() {\n    var self = this;\n    var graph = self.get('graph');\n    var nodes = self.get('data').nodes;\n    var edges = self.get('data').edges;\n    var maxIteration = self.get('maxIteration'); // const linkDistance = self.get('linkDistance');\n\n    var width = graph.get('width');\n    var height = graph.get('height');\n    var nodeMap = self.get('nodeMap');\n    var nodeIndexMap = self.get('nodeIndexMap');\n    var maxDisplace = width / 10;\n    var k = Math.sqrt(width * height / (nodes.length + 1));\n    var gravity = self.get('gravity');\n    var speed = self.get('speed');\n\n    var _loop = function _loop(i) {\n      var disp = [];\n      nodes.forEach(function (n, i) {\n        disp[i] = {\n          x: 0,\n          y: 0\n        };\n      });\n      self.getDisp(nodes, edges, nodeMap, nodeIndexMap, disp, k); // gravity\n\n      nodes.forEach(function (n, i) {\n        var distLength = Math.sqrt(disp[i].x * disp[i].x + disp[i].y * disp[i].y);\n        var gravityForce = 0.01 * k * gravity * distLength;\n        disp[i].x -= gravityForce * n.x / distLength;\n        disp[i].y -= gravityForce * n.y / distLength;\n      }); // speed\n\n      nodes.forEach(function (n, i) {\n        disp[i].dx *= speed / SPEED_DIVISOR;\n        disp[i].dy *= speed / SPEED_DIVISOR;\n      }); // move\n\n      nodes.forEach(function (n, i) {\n        var distLength = Math.sqrt(disp[i].x * disp[i].x + disp[i].y * disp[i].y);\n\n        if (distLength > 0) {\n          // && !n.isFixed()\n          var limitedDist = Math.min(maxDisplace * (speed / SPEED_DIVISOR), distLength);\n          n.x += disp[i].x / distLength * limitedDist;\n          n.y += disp[i].y / distLength * limitedDist;\n        }\n      });\n    };\n\n    for (var i = 0; i < maxIteration; i++) {\n      _loop(i);\n    }\n  };\n\n  _proto.getDisp = function getDisp(nodes, edges, nodeMap, nodeIndexMap, disp, k) {\n    var self = this;\n    self.calRepulsive(nodes, disp, k);\n    self.calAttractive(edges, nodeMap, nodeIndexMap, disp, k);\n  };\n\n  _proto.calRepulsive = function calRepulsive(nodes, disp, k) {\n    nodes.forEach(function (v, i) {\n      disp[i] = {\n        x: 0,\n        y: 0\n      };\n      nodes.forEach(function (u, j) {\n        if (i === j) return;\n        var vecx = v.x - u.x;\n        var vecy = v.y - u.y;\n        var vecLengthSqr = vecx * vecx + vecy * vecy;\n        if (vecLengthSqr === 0) vecLengthSqr = 1;\n        var common = k * k / vecLengthSqr;\n        disp[i].x += vecx * common;\n        disp[i].y += vecy * common;\n      });\n    });\n  };\n\n  _proto.calAttractive = function calAttractive(edges, nodeMap, nodeIndexMap, disp, k) {\n    edges.forEach(function (e) {\n      var uIndex = nodeIndexMap.get(e.source);\n      var vIndex = nodeIndexMap.get(e.target);\n      var u = nodeMap.get(e.source);\n      var v = nodeMap.get(e.target);\n      var vecx = v.x - u.x;\n      var vecy = v.y - u.y;\n      var vecLength = Math.sqrt(vecx * vecx + vecy * vecy);\n      var common = vecLength * vecLength / k;\n      disp[vIndex].x -= vecx / vecLength * common;\n      disp[vIndex].y -= vecy / vecLength * common;\n      disp[uIndex].x += vecx / vecLength * common;\n      disp[uIndex].y += vecy / vecLength * common;\n    });\n  };\n\n  _proto.updateLayout = function updateLayout(cfg) {\n    var self = this;\n    var data = cfg.data;\n\n    if (data) {\n      self.set('data', data);\n    }\n\n    if (self.get('ticking')) {\n      // stop layout\n      self.set('ticking', false);\n    }\n\n    Object.keys(cfg).forEach(function (key) {\n      self.set(key, cfg[key]);\n    });\n    self.layout(data);\n  };\n\n  _proto.isTicking = function isTicking() {\n    return this.get('ticking');\n  };\n\n  _proto.destroy = function destroy() {\n    if (this.get('ticking')) {\n      this.getSimulation().stop();\n    }\n\n    _Base.prototype.destroy.call(this);\n  };\n\n  return Fruchterman;\n}(Base);\n\nmodule.exports = Fruchterman;"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AClFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AC3CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AClBA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACvBA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AChEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;A","sourceRoot":""}